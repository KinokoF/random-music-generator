var ln=Object.defineProperty;var ve=(e,t)=>{for(var n in t)ln(e,n,{get:t[n],enumerable:!0})};var dn=Object.defineProperty,fn=(e,t,n)=>t in e?dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,d=(e,t,n)=>fn(e,typeof t!="symbol"?t+"":t,n),X=class{},hn=class Ge extends X{constructor(t){var n;super(),d(this,"_name"),d(this,"_rngFn"),this._name=(n=t.name)!=null?n:"function",this._rngFn=t}get name(){return this._name}next(){return this._rngFn()}clone(){return new Ge(this._rngFn)}};function $e(e){switch(typeof e){case"object":if(e instanceof X)return e;break;case"function":return new hn(e);default:return new bn(e)}throw new Error(`invalid RNG seed or instance "${e}"`)}function pn(e){if(e===void 0&&(e=crypto.randomUUID()),typeof e=="number")return e;let t=`${e}`,n=0;for(let r=0;r<t.length;++r)n^=t.charCodeAt(r)|0;return n}function gn(e,t){var n;let r=`${e}`,a=0,i=0;for(;i<r.length;)t[255&i]=255&(a^=((n=t[255&i])!=null?n:0)*19)+r.charCodeAt(i++);return t.length?t:[0]}var Pn=281474976710656,Mn=4503599627370496,yn=9007199254740992,bn=class Le extends X{constructor(t){super(),d(this,"_seed"),d(this,"i"),d(this,"j"),d(this,"S");let n=pn(t);this._seed=n;let r=gn(n,[]),a=[],i=r.length;this.i=0,this.j=0,this.S=a;let o=0;for(;o<=255;)a[o]=o++;for(let m=0,s=0;m<=255;m++){let c=a[m];s=255&s+r[m%i]+c,a[m]=a[s],a[s]=c}this.g(256)}get name(){return"arc4"}next(){let t=this.g(6),n=Pn,r=0;for(;t<Mn;)t=(t+r)*256,n*=256,r=this.g(1);for(;t>=yn;)t/=2,n/=2,r>>>=1;return(t+r)/n}g(t){let{S:n}=this,{i:r,j:a}=this,i=0;for(;t--;){r=255&r+1;let o=n[r];n[a]=o,a=255&a+o,n[r]=n[a],i=i*256+n[255&n[r]+o]}return this.i=r,this.j=a,i}clone(){return new Le(this._seed)}},vn=class qe extends X{get name(){return"Math.random"}next(){return Math.random()}clone(){return new qe}};function x(e){return new An(e)}var An=class{constructor(e){d(this,"n"),d(this,"isInt",()=>{if(Number.isInteger(this.n))return this;throw new Error(`Expected number to be an integer, got ${this.n}`)}),d(this,"isPositive",()=>{if(this.n>0)return this;throw new Error(`Expected number to be positive, got ${this.n}`)}),d(this,"lessThan",t=>{if(this.n<t)return this;throw new Error(`Expected number to be less than ${t}, got ${this.n}`)}),d(this,"greaterThanOrEqual",t=>{if(this.n>=t)return this;throw new Error(`Expected number to be greater than or equal to ${t}, got ${this.n}`)}),d(this,"greaterThan",t=>{if(this.n>t)return this;throw new Error(`Expected number to be greater than ${t}, got ${this.n}`)}),this.n=e}};function Nn(e,t=1){x(t).isInt().isPositive();let n=e.irwinHall(t);return()=>n()/t}function xn(e,t=.5){return x(t).greaterThanOrEqual(0).lessThan(1),()=>Math.floor(e.next()+t)}function Cn(e,t=1,n=.5){return x(t).isInt().isPositive(),x(n).greaterThanOrEqual(0).lessThan(1),()=>{let r=0,a=0;for(;r++<t;)e.next()<n&&a++;return a}}function _n(e,t=1){return x(t).isPositive(),()=>-Math.log(1-e.next())/t}function Sn(e,t=.5){x(t).greaterThan(0).lessThan(1);let n=1/Math.log(1-t);return()=>Math.floor(1+Math.log(e.next())*n)}function In(e,t=1){return x(t).isInt().greaterThanOrEqual(0),()=>{let n=0;for(let r=0;r<t;++r)n+=e.next();return n}}function Tn(e,t=0,n=1){let r=e.normal(t,n);return()=>Math.exp(r())}function En(e,t=0,n=1){return()=>{let r,a,i;do r=e.next()*2-1,a=e.next()*2-1,i=r*r+a*a;while(!i||i>1);return t+n*a*Math.sqrt(-2*Math.log(i)/i)}}function wn(e,t=1){x(t).greaterThanOrEqual(0);let n=1/t;return()=>1/Math.pow(1-e.next(),n)}var jn=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],Dn=e=>jn[e],Fn=.9189385332046727;function Rn(e,t=1){if(x(t).isPositive(),t<10){let n=Math.exp(-t);return()=>{let r=n,a=0,i=e.next();for(;i>r;)i=i-r,r=t*r/++a;return a}}else{let n=Math.sqrt(t),r=.931+2.53*n,a=-.059+.02483*r,i=1.1239+1.1328/(r-3.4),o=.9277-3.6224/(r-2);return()=>{for(var m;;){let s,c=e.next();if(c<=.86*o)return s=c/o-.43,Math.floor((2*a/(.5-Math.abs(s))+r)*s+t+.445);c>=o?s=e.next()-.5:(s=c/o-.93,s=(s<0?-.5:.5)-s,c=e.next()*o);let f=.5-Math.abs(s);if(f<.013&&c>f)continue;let l=Math.floor((2*a/f+r)*s+t+.445);if(c=c*i/(a/(f*f)+r),l>=10){let h=(l+.5)*Math.log(t/l)-t-Fn+l-(.08333333333333333-(.002777777777777778-1/(1260*l*l))/(l*l))/l;if(Math.log(c*n)<=h)return l}else if(l>=0){let h=(m=Dn(l))!=null?m:0;if(Math.log(c)<=l*Math.log(t)-t-h)return l}}}}}function On(e,t=0,n=1){return()=>e.next()*(n-t)+t}function kn(e){return()=>e.next()>=.5}function Vn(e,t=0,n=1){return n===void 0&&(n=t===void 0?1:t,t=0),x(t).isInt(),x(n).isInt(),()=>Math.floor(e.next()*(n-t+1)+t)}var Bn=class ze{constructor(t=new vn){d(this,"_rng"),d(this,"_cache",{}),d(this,"next",()=>this._rng.next()),d(this,"float",(n,r)=>this.uniform(n,r)()),d(this,"int",(n,r)=>this.uniformInt(n,r)()),d(this,"integer",(n,r)=>this.uniformInt(n,r)()),d(this,"bool",()=>this.uniformBoolean()()),d(this,"boolean",()=>this.uniformBoolean()()),d(this,"uniform",(n,r)=>this._memoize("uniform",On,n,r)),d(this,"uniformInt",(n,r)=>this._memoize("uniformInt",Vn,n,r)),d(this,"uniformBoolean",()=>this._memoize("uniformBoolean",kn)),d(this,"normal",(n,r)=>En(this,n,r)),d(this,"logNormal",(n,r)=>Tn(this,n,r)),d(this,"bernoulli",n=>xn(this,n)),d(this,"binomial",(n,r)=>Cn(this,n,r)),d(this,"geometric",n=>Sn(this,n)),d(this,"poisson",n=>Rn(this,n)),d(this,"exponential",n=>_n(this,n)),d(this,"irwinHall",n=>In(this,n)),d(this,"bates",n=>Nn(this,n)),d(this,"pareto",n=>wn(this,n)),this._rng=$e(t)}get rng(){return this._rng}clone(t=this.rng.clone()){return new ze(t)}use(t){this._rng=$e(t)}choice(t){if(!Array.isArray(t))throw new TypeError(`Random.choice expected input to be an array, got ${typeof t}`);let n=t.length;if(n>0){let r=this.uniformInt(0,n-1)();return t[r]}else return}_memoize(t,n,...r){let a=`${r.join(";")}`,i=this._cache[t];return(i===void 0||i.key!==a)&&(i={key:a,distribution:n(this,...r)},this._cache[t]=i),i.distribution}},p=new Bn;function E(e){return e!==null&&typeof e=="object"&&"name"in e&&typeof e.name=="string"}function V(e){return e!==null&&typeof e=="object"&&"step"in e&&typeof e.step=="number"&&"alt"in e&&typeof e.alt=="number"&&!isNaN(e.step)&&!isNaN(e.alt)}var He=[0,2,4,-1,1,3,5],Ue=He.map(e=>Math.floor(e*7/12));function K(e){let{step:t,alt:n,oct:r,dir:a=1}=e,i=He[t]+7*n;if(r===void 0)return[a*i];let o=r-Ue[t]-4*n;return[a*i,a*o]}var $n=[3,0,4,1,5,2,6];function Q(e){let[t,n,r]=e,a=$n[Gn(t)],i=Math.floor((t+1)/7);if(n===void 0)return{step:a,alt:i,dir:r};let o=n+4*i+Ue[a];return{step:a,alt:i,oct:o,dir:r}}function Gn(e){let t=(e+1)%7;return t<0?7+t:t}var Ye=(e,t)=>Array(Math.abs(t)+1).join(e),Ae=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),Ln="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",qn="(AA|A|P|M|m|d|dd)([-+]?\\d+)",zn=new RegExp("^"+Ln+"|"+qn+"$");function Hn(e){let t=zn.exec(`${e}`);return t===null?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}var Xe={};function y(e){return typeof e=="string"?Xe[e]||(Xe[e]=Un(e)):V(e)?y(Xn(e)):E(e)?y(e.name):Ae}var Ke=[0,2,4,5,7,9,11],Qe="PMMPPMM";function Un(e){let t=Hn(e);if(t[0]==="")return Ae;let n=+t[0],r=t[1],a=(Math.abs(n)-1)%7,i=Qe[a];if(i==="M"&&r==="P")return Ae;let o=i==="M"?"majorable":"perfectable",m=""+n+r,s=n<0?-1:1,c=n===8||n===-8?n:s*(a+1),f=Yn(o,r),l=Math.floor((Math.abs(n)-1)/7),h=s*(Ke[a]+f+12*l),M=(s*(Ke[a]+f)%12+12)%12,v=K({step:a,alt:f,oct:l,dir:s});return{empty:!1,name:m,num:n,q:r,step:a,alt:f,dir:s,type:o,simple:c,semitones:h,chroma:M,coord:v,oct:l}}function W(e,t){let[n,r=0]=e,a=n*7+r*12<0,i=t||a?[-n,-r,-1]:[n,r,1];return y(Q(i))}function Yn(e,t){return t==="M"&&e==="majorable"||t==="P"&&e==="perfectable"?0:t==="m"&&e==="majorable"?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*(e==="perfectable"?t.length:t.length+1):0}function Xn(e){let{step:t,alt:n,oct:r=0,dir:a}=e;if(!a)return"";let i=t+1+7*r,o=i===0?t+1:i,m=a<0?"-":"",s=Qe[t]==="M"?"majorable":"perfectable";return m+o+Kn(s,n)}function Kn(e,t){return t===0?e==="majorable"?"M":"P":t===-1&&e==="majorable"?"m":t>0?Ye("A",t):Ye("d",e==="perfectable"?t:t+1)}var We=(e,t)=>Array(Math.abs(t)+1).join(e),Ze=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),Je=new Map,Qn=e=>"CDEFGAB".charAt(e),J=e=>e<0?We("b",-e):We("#",e),Z=e=>e[0]==="b"?-e.length:e.length;function u(e){let t=JSON.stringify(e),n=Je.get(t);if(n)return n;let r=typeof e=="string"?Zn(e):V(e)?u(er(e)):E(e)?u(e.name):Ze;return Je.set(t,r),r}var Wn=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function ee(e){let t=Wn.exec(e);return t?[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]:["","","",""]}function et(e){return u(Q(e))}var Jn=(e,t)=>(e%t+t)%t,Ne=[0,2,4,5,7,9,11];function Zn(e){let t=ee(e);if(t[0]===""||t[3]!=="")return Ze;let n=t[0],r=t[1],a=t[2],i=(n.charCodeAt(0)+3)%7,o=Z(r),m=a.length?+a:void 0,s=K({step:i,alt:o,oct:m}),c=n+r+a,f=n+r,l=(Ne[i]+o+120)%12,h=m===void 0?Jn(Ne[i]+o,12)-12*99:Ne[i]+o+12*(m+1),M=h>=0&&h<=127?h:null,v=m===void 0?null:Math.pow(2,(h-69)/12)*440;return{empty:!1,acc:r,alt:o,chroma:l,coord:s,freq:v,height:h,letter:n,midi:M,name:c,oct:m,pc:f,step:i}}function er(e){let{step:t,alt:n,oct:r}=e,a=Qn(t);if(!a)return"";let i=a+J(n);return r||r===0?i+r:i}function g(e,t){let n=u(e),r=Array.isArray(t)?t:y(t).coord;if(n.empty||!r||r.length<2)return"";let a=n.coord,i=a.length===1?[a[0]+r[0]]:[a[0]+r[0],a[1]+r[1]];return et(i).name}function B(e,t){let n=e.length;return r=>{if(!t)return"";let a=r<0?(n- -r%n)%n:r%n,i=Math.floor(r/n),o=g(t,[0,i]);return g(o,e[a])}}function w(e,t){let n=u(e),r=u(t);if(n.empty||r.empty)return"";let a=n.coord,i=r.coord,o=i[0]-a[0],m=a.length===2&&i.length===2?i[1]-a[1]:-Math.floor(o*7/12),s=r.height===n.height&&r.midi!==null&&n.oct===r.oct&&n.step>r.step;return W([o,m],s).name}var Y={};ve(Y,{chord:()=>lt,chordScales:()=>ft,default:()=>se,degrees:()=>Pt,detect:()=>ae,extended:()=>ht,get:()=>T,getChord:()=>H,notes:()=>gt,reduced:()=>pt,steps:()=>Mt,tokenize:()=>U,transpose:()=>dt});function rr(e,t){let n=[];for(;t--;n[t]=t+e);return n}function ar(e,t){let n=[];for(;t--;n[t]=e-t);return n}function te(e,t){return e<t?rr(e,t-e+1):ar(e,e-t+1)}function j(e,t){let n=t.length,r=(e%n+n)%n;return t.slice(r,n).concat(t.slice(0,r))}function xe(e){return e.filter(t=>t===0||t)}var _={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},rt=e=>Number(e).toString(2).padStart(12,"0"),tt=e=>parseInt(e,2),or=/^[01]{12}$/;function ne(e){return or.test(e)}var mr=e=>typeof e=="number"&&e>=0&&e<=4095,sr=e=>e&&ne(e.chroma),nt={[_.chroma]:_};function S(e){let t=ne(e)?e:mr(e)?rt(e):Array.isArray(e)?fr(e):sr(e)?e.chroma:_.chroma;return nt[t]=nt[t]||dr(t)}var at=e=>S(e).chroma;var cr=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function ur(e){let t=[];for(let n=0;n<12;n++)e.charAt(n)==="1"&&t.push(cr[n]);return t}function re(e,t=!0){let r=S(e).chroma.split("");return xe(r.map((a,i)=>{let o=j(i,r);return t&&o[0]==="0"?null:o.join("")}))}function G(e){let t=S(e).setNum;return n=>{let r=S(n).setNum;return t&&t!==r&&(r&t)===r}}function L(e){let t=S(e).setNum;return n=>{let r=S(n).setNum;return t&&t!==r&&(r|t)===r}}function lr(e){let t=e.split("");return t.map((n,r)=>j(r,t).join(""))}function dr(e){let t=tt(e),n=lr(e).map(tt).filter(i=>i>=2048).sort()[0],r=rt(n),a=ur(e);return{empty:!1,name:"",setNum:t,chroma:e,normalized:r,intervals:a}}function fr(e){if(e.length===0)return _.chroma;let t,n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<e.length;r++)t=u(e[r]),t.empty&&(t=y(e[r])),t.empty||(n[t.chroma]=1);return n.join("")}var pr=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 \u0394 ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 \u03949 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 \u0394#4 \u0394#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -\u03947 m\u0394 -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim \xB0 o"],["1P 3m 5d 7d","diminished seventh","dim7 \xB07 o7"],["1P 3m 5d 7m","half-diminished","m7b5 \xF8 -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 \u03949#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],gr=pr,Pr={..._,name:"",quality:"Unknown",intervals:[],aliases:[]},Ce=[],q={};function it(e){return q[e]||Pr}function R(){return Ce.slice()}function Mr(e,t,n){let r=br(e),a={...S(e),name:n||"",quality:r,intervals:e,aliases:t};Ce.push(a),a.name&&(q[a.name]=a),q[a.setNum]=a,q[a.chroma]=a,a.aliases.forEach(i=>yr(a,i))}function yr(e,t){q[t]=e}function br(e){let t=n=>e.indexOf(n)!==-1;return t("5A")?"Augmented":t("3M")?"Major":t("5d")?"Diminished":t("3m")?"Minor":"Unknown"}gr.forEach(([e,t,n])=>Mr(e.split(" "),n.split(" "),t));Ce.sort((e,t)=>e.setNum-t.setNum);var vr=e=>{let t=e.reduce((n,r)=>{let a=u(r).chroma;return a!==void 0&&(n[a]=n[a]||u(r).name),n},{});return n=>t[n]};function ae(e,t={}){let n=e.map(a=>u(a).pc).filter(a=>a);return u.length===0?[]:Ir(n,1,t).filter(a=>a.weight).sort((a,i)=>i.weight-a.weight).map(a=>a.name)}var ie={anyThirds:384,perfectFifth:16,nonPerfectFifths:40,anySeventh:3},oe=e=>t=>!!(t&e),Ar=oe(ie.anyThirds),Nr=oe(ie.perfectFifth),xr=oe(ie.anySeventh),Cr=oe(ie.nonPerfectFifths);function _r(e){let t=parseInt(e.chroma,2);return Ar(t)&&Nr(t)&&xr(t)}function Sr(e){let t=parseInt(e,2);return Cr(t)?e:(t|16).toString(2)}function Ir(e,t,n){let r=e[0],a=u(r).chroma,i=vr(e),o=re(e,!1),m=[];return o.forEach((s,c)=>{let f=n.assumePerfectFifth&&Sr(s);R().filter(h=>n.assumePerfectFifth&&_r(h)?h.chroma===f:h.chroma===s).forEach(h=>{let M=h.aliases[0],v=i(c);c!==a?m.push({weight:.5*t,name:`${v}${M}/${r}`}):m.push({weight:1*t,name:`${v}${M}`})})}),m}var ri="P m M m M P d P m M m M".split(" ");var ai=st((e,t)=>[e[0]+t[0],e[1]+t[1]]);var mt=st((e,t)=>[e[0]-t[0],e[1]-t[1]]);function st(e){return(t,n)=>{let r=y(t).coord,a=y(n).coord;if(r&&a){let i=e(r,a);return W(i).name}}}var Er=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],wr=Er,jr={..._,intervals:[],aliases:[]},_e=[],z={};function ct(){return _e.map(e=>e.name)}function me(e){return z[e]||jr}function O(){return _e.slice()}function Dr(e,t,n=[]){let r={...S(e),name:t,intervals:e,aliases:n};return _e.push(r),z[r.name]=r,z[r.setNum]=r,z[r.chroma]=r,r.aliases.forEach(a=>Fr(r,a)),r}function Fr(e,t){z[t]=e}wr.forEach(([e,t,...n])=>Dr(e.split(" "),t,n));var ut={empty:!0,name:"",symbol:"",root:"",bass:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function U(e){let[t,n,r,a]=ee(e);return t===""?Se("",e):t==="A"&&a==="ug"?Se("","aug"):Se(t+n,r+a)}function Se(e,t){let n=t.split("/");if(n.length===1)return[e,n[0],""];let[r,a,i,o]=ee(n[1]);return r!==""&&i===""&&o===""?[e,n[0],r+a]:[e,t,""]}function T(e){if(Array.isArray(e))return H(e[1]||"",e[0],e[2]);if(e==="")return ut;{let[t,n,r]=U(e),a=H(n,t,r);return a.empty?H(e):a}}function H(e,t,n){let r=it(e),a=u(t||""),i=u(n||"");if(r.empty||t&&a.empty||n&&i.empty)return ut;let o=w(a.pc,i.pc),m=r.intervals.indexOf(o),s=m>=0,c=s?i:u(""),f=m===-1?NaN:m+1,l=i.pc&&i.pc!==a.pc,h=Array.from(r.intervals);if(s)for(let I=1;I<f;I++){let Me=h[0][0],ye=h[0][1],be=parseInt(Me,10)+7;h.push(`${be}${ye}`),h.shift()}else if(l){let I=mt(w(a.pc,i.pc),"8P");I&&h.unshift(I)}let M=a.empty?[]:h.map(I=>g(a.pc,I));e=r.aliases.indexOf(e)!==-1?e:r.aliases[0];let v=`${a.empty?"":a.pc}${e}${s&&f>1?"/"+c.pc:l?"/"+i.pc:""}`,k=`${t?a.pc+" ":""}${r.name}${s&&f>1?" over "+c.pc:l?" over "+i.pc:""}`;return{...r,name:k,symbol:v,tonic:a.pc,type:r.name,root:c.pc,bass:l?i.pc:"",intervals:h,rootDegree:f,notes:M}}var lt=T;function dt(e,t){let[n,r,a]=U(e);if(!n)return e;let i=g(a,t),o=i?"/"+i:"";return g(n,t)+r+o}function ft(e){let t=T(e),n=L(t.chroma);return O().filter(r=>n(r.chroma)).map(r=>r.name)}function ht(e){let t=T(e),n=L(t.chroma);return R().filter(r=>n(r.chroma)).map(r=>t.tonic+r.aliases[0])}function pt(e){let t=T(e),n=G(t.chroma);return R().filter(r=>n(r.chroma)).map(r=>t.tonic+r.aliases[0])}function gt(e,t){let n=T(e),r=t||n.tonic;return!r||n.empty?[]:n.intervals.map(a=>g(r,a))}function Pt(e,t){let n=T(e),r=t||n.tonic,a=B(n.intervals,r);return i=>i?a(i>0?i-1:i):""}function Mt(e,t){let n=T(e),r=t||n.tonic;return B(n.intervals,r)}var se={getChord:H,get:T,detect:ae,chordScales:ft,extended:ht,reduced:pt,tokenize:U,transpose:dt,degrees:Pt,steps:Mt,notes:gt,chord:lt};var Or=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],kr=Or,Vr=[];kr.forEach(([e,t,n])=>Br(e,t,n));function Br(e,t,n){Vr.push({empty:!1,dots:"",name:"",value:1/e,fraction:e<1?[1/e,1]:[1,e],shorthand:t,names:n})}var P={};ve(P,{accidentals:()=>xt,ascending:()=>le,chroma:()=>It,default:()=>he,descending:()=>Vt,distance:()=>jt,enharmonic:()=>fe,freq:()=>St,fromFreq:()=>Tt,fromFreqSharps:()=>Et,fromMidi:()=>ce,fromMidiSharps:()=>wt,get:()=>A,midi:()=>_t,name:()=>At,names:()=>vt,octave:()=>Ct,pitchClass:()=>Nt,simplify:()=>Bt,sortedNames:()=>we,sortedUniqNames:()=>de,tr:()=>Dt,trBy:()=>Ft,trFifths:()=>Ot,trFrom:()=>Rt,transpose:()=>F,transposeBy:()=>Te,transposeFifths:()=>ue,transposeFrom:()=>Ee,transposeOctaves:()=>kt});var Gr=Math.log(2),Lr=Math.log(440);function Ie(e){let t=12*(Math.log(e)-Lr)/Gr+69;return Math.round(t*100)/100}var qr="C C# D D# E F F# G G# A A# B".split(" "),zr="C Db D Eb E F Gb G Ab A Bb B".split(" ");function D(e,t={}){if(isNaN(e)||e===-1/0||e===1/0)return"";e=Math.round(e);let r=(t.sharps===!0?qr:zr)[e%12];if(t.pitchClass)return r;let a=Math.floor(e/12)-1;return r+a}var Ur=["C","D","E","F","G","A","B"],yt=e=>e.name,bt=e=>e.map(u).filter(t=>!t.empty);function vt(e){return e===void 0?Ur.slice():Array.isArray(e)?bt(e).map(yt):[]}var A=u,At=e=>A(e).name,Nt=e=>A(e).pc,xt=e=>A(e).acc,Ct=e=>A(e).oct,_t=e=>A(e).midi,St=e=>A(e).freq,It=e=>A(e).chroma;function ce(e){return D(e)}function Tt(e){return D(Ie(e))}function Et(e){return D(Ie(e),{sharps:!0})}function wt(e){return D(e,{sharps:!0})}var jt=w,F=g,Dt=g,Te=e=>t=>F(t,e),Ft=Te,Ee=e=>t=>F(e,t),Rt=Ee;function ue(e,t){return F(e,[t,0])}var Ot=ue;function kt(e,t){return F(e,[0,t])}var le=(e,t)=>e.height-t.height,Vt=(e,t)=>t.height-e.height;function we(e,t){return t=t||le,bt(e).sort(t).map(yt)}function de(e){return we(e,le).filter((t,n,r)=>n===0||t!==r[n-1])}var Bt=e=>{let t=A(e);return t.empty?"":D(t.midi||t.chroma,{sharps:t.alt>0,pitchClass:t.midi===null})};function fe(e,t){let n=A(e);if(n.empty)return"";let r=A(t||D(n.midi||n.chroma,{sharps:n.alt<0,pitchClass:!0}));if(r.empty||r.chroma!==n.chroma)return"";if(n.oct===void 0)return r.pc;let a=n.chroma-n.alt,i=r.chroma-r.alt,o=a>11||i<0?-1:a<0||i>11?1:0,m=n.oct+o;return r.pc+m}var he={names:vt,get:A,name:At,pitchClass:Nt,accidentals:xt,octave:Ct,midi:_t,ascending:le,descending:Vt,distance:jt,sortedNames:we,sortedUniqNames:de,fromMidi:ce,fromMidiSharps:wt,freq:St,fromFreq:Tt,fromFreqSharps:Et,chroma:It,transpose:F,tr:Dt,transposeBy:Te,trBy:Ft,transposeFrom:Ee,trFrom:Rt,transposeFifths:ue,transposeOctaves:kt,trFifths:Ot,simplify:Bt,enharmonic:fe};var Gt={empty:!0,name:"",chordType:""},$t={};function $(e){return typeof e=="string"?$t[e]||($t[e]=Qr(e)):typeof e=="number"?$(je[e]||""):V(e)?Yr(e):E(e)?$(e.name):Gt}function Yr(e){return $(J(e.alt)+je[e.step])}var Xr=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function Kr(e){return Xr.exec(e)||["","","",""]}var Lt="I II III IV V VI VII",je=Lt.split(" "),vi=Lt.toLowerCase().split(" ");function Qr(e){let[t,n,r,a]=Kr(e);if(!r)return Gt;let i=r.toUpperCase(),o=je.indexOf(i),m=Z(n),s=1;return{empty:!1,name:t,roman:r,interval:y({step:o,alt:m,dir:s}).name,acc:n,chordType:a,alt:m,step:o,major:r===i,oct:0,dir:s}}var N=Object.freeze([]),qt={type:"major",tonic:"",alteration:0,keySignature:""},pe={tonic:"",grades:N,intervals:N,scale:N,triads:N,chords:N,chordsHarmonicFunction:N,chordScales:N},Ci={...qt,...pe,type:"major",minorRelative:"",scale:N,secondaryDominants:N,secondaryDominantsMinorRelative:N,substituteDominants:N,substituteDominantsMinorRelative:N},_i={...qt,type:"minor",relativeMajor:"",natural:pe,harmonic:pe,melodic:pe},De=(e,t,n="")=>t.map((r,a)=>`${e[a]}${n}${r}`);function ge(e,t,n,r,a){return i=>{let o=e.map(s=>$(s).interval||""),m=o.map(s=>F(i,s));return{tonic:i,grades:e,intervals:o,scale:m,triads:De(m,t),chords:De(m,n),chordsHarmonicFunction:r.slice(),chordScales:De(m,a," ")}}}var Si=ge("I II III IV V VI VII".split(" ")," m m   m dim".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(",")),Ii=ge("I II bIII IV V bVI bVII".split(" "),"m dim  m m  ".split(" "),"m7 m7b5 maj7 m7 m7 maj7 7".split(" "),"T SD T SD D SD SD".split(" "),"minor,locrian,major,dorian,phrygian,lydian,mixolydian".split(",")),Ti=ge("I II bIII IV V bVI VII".split(" "),"m dim aug m   dim".split(" "),"mMaj7 m7b5 +maj7 m7 7 maj7 o7".split(" "),"T SD T SD D SD D".split(" "),"harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian".split(",")),Ei=ge("I II bIII IV V VI VII".split(" "),"m m aug   dim dim".split(" "),"m6 m7 +maj7 7 7 m7b5 m7b5".split(" "),"T SD T SD D  ".split(" "),"melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered".split(","));var Re=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],zt={..._,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},Zr=Re.map(ea),Fe={};Zr.forEach(e=>{Fe[e.name]=e,e.aliases.forEach(t=>{Fe[t]=e})});function Ht(e){return typeof e=="string"?Fe[e.toLowerCase()]||zt:e&&e.name?Ht(e.name):zt}function ea(e){let[t,n,r,a,i,o,m]=e,s=m?[m]:[],c=Number(n).toString(2);return{empty:!1,intervals:me(a).intervals,modeNum:t,chroma:c,normalized:c,name:a,setNum:n,alt:r,triad:i,seventh:o,aliases:s}}function Ut(e){return(t,n)=>{let r=Ht(t);if(r.empty)return[];let a=j(r.modeNum,e),i=r.intervals.map(o=>g(n,o));return a.map((o,m)=>i[m]+o)}}var Vi=Ut(Re.map(e=>e[4])),Bi=Ut(Re.map(e=>e[5]));var Pe={};ve(Pe,{default:()=>ma,degrees:()=>en,detect:()=>Kt,extended:()=>ke,get:()=>C,modeNames:()=>Jt,names:()=>Yt,rangeOf:()=>Zt,reduced:()=>Wt,scale:()=>Xt,scaleChords:()=>Qt,scaleNotes:()=>Ve,steps:()=>tn,tokenize:()=>Oe});var ia={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function Oe(e){if(typeof e!="string")return["",""];let t=e.indexOf(" "),n=u(e.substring(0,t));if(n.empty){let a=u(e);return a.empty?["",e]:[a.name,""]}let r=e.substring(n.name.length+1).toLowerCase();return[n.name,r.length?r:""]}var Yt=ct;function C(e){let t=Array.isArray(e)?e:Oe(e),n=u(t[0]).name,r=me(t[1]);if(r.empty)return ia;let a=r.name,i=n?r.intervals.map(m=>g(n,m)):[],o=n?n+" "+a:a;return{...r,name:o,type:a,tonic:n,notes:i}}var Xt=C;function Kt(e,t={}){let n=at(e),r=u(t.tonic??e[0]??""),a=r.chroma;if(a===void 0)return[];let i=n.split("");i[a]="1";let o=j(a,i).join(""),m=O().find(c=>c.chroma===o),s=[];return m&&s.push(r.name+" "+m.name),t.match==="exact"||ke(o).forEach(c=>{s.push(r.name+" "+c)}),s}function Qt(e){let t=C(e),n=G(t.chroma);return R().filter(r=>n(r.chroma)).map(r=>r.aliases[0])}function ke(e){let t=ne(e)?e:C(e).chroma,n=L(t);return O().filter(r=>n(r.chroma)).map(r=>r.name)}function Wt(e){let t=G(C(e).chroma);return O().filter(n=>t(n.chroma)).map(n=>n.name)}function Ve(e){let t=e.map(a=>u(a).pc).filter(a=>a),n=t[0],r=de(t);return j(r.indexOf(n),r)}function Jt(e){let t=C(e);if(t.empty)return[];let n=t.tonic?t.notes:t.intervals;return re(t.chroma).map((r,a)=>{let i=C(r).name;return i?[n[a],i]:["",""]}).filter(r=>r[0])}function oa(e){let t=Array.isArray(e)?Ve(e):C(e).notes,n=t.map(r=>u(r).chroma);return r=>{let a=typeof r=="number"?u(ce(r)):u(r),i=a.height;if(i===void 0)return;let o=i%12,m=n.indexOf(o);if(m!==-1)return fe(a.name,t[m])}}function Zt(e){let t=oa(e);return(n,r)=>{let a=u(n).height,i=u(r).height;return a===void 0||i===void 0?[]:te(a,i).map(t).filter(o=>o)}}function en(e){let{intervals:t,tonic:n}=C(e),r=B(t,n);return a=>a?r(a>0?a-1:a):""}function tn(e){let{intervals:t,tonic:n}=C(e);return B(t,n)}var ma={degrees:en,detect:Kt,extended:ke,get:C,modeNames:Jt,names:Yt,rangeOf:Zt,reduced:Wt,scaleChords:Qt,scaleNotes:Ve,steps:tn,tokenize:Oe,scale:Xt};var ca=(e,t)=>{if(!t||!t.length)return e[0];let n=a=>he.midi(a[a.length-1])||0,r=a=>Math.abs(n(t)-n(a));return e.sort((a,i)=>r(a)-r(i))[0]},nn={topNoteDiff:ca};var la={M:["1P 3M 5P","3M 5P 8P","5P 8P 10M"],m:["1P 3m 5P","3m 5P 8P","5P 8P 10m"],o:["1P 3m 5d","3m 5d 8P","5d 8P 10m"],aug:["1P 3m 5A","3m 5A 8P","5A 8P 10m"]},rn={m7:["3m 5P 7m 9M","7m 9M 10m 12P"],7:["3M 6M 7m 9M","7m 9M 10M 13M"],"^7":["3M 5P 7M 9M","7M 9M 10M 12P"],69:["3M 5P 6A 9M"],m7b5:["3m 5d 7m 8P","7m 8P 10m 12d"],"7b9":["3M 6m 7m 9m","7m 9m 10M 13m"],"7b13":["3M 6m 7m 9m","7m 9m 10M 13m"],o7:["1P 3m 5d 6M","5d 6M 8P 10m"],"7#11":["7m 9M 11A 13A"],"7#9":["3M 7m 9A"],mM7:["3m 5P 7M 9M","7M 9M 10m 12P"],m6:["3m 5P 6M 9M","6M 9M 10m 12P"]},da={M:["1P 3M 5P","3M 5P 8P","5P 8P 10M"],m:["1P 3m 5P","3m 5P 8P","5P 8P 10m"],o:["1P 3m 5d","3m 5d 8P","5d 8P 10m"],aug:["1P 3m 5A","3m 5A 8P","5A 8P 10m"],m7:["3m 5P 7m 9M","7m 9M 10m 12P"],7:["3M 6M 7m 9M","7m 9M 10M 13M"],"^7":["3M 5P 7M 9M","7M 9M 10M 12P"],69:["3M 5P 6A 9M"],m7b5:["3m 5d 7m 8P","7m 8P 10m 12d"],"7b9":["3M 6m 7m 9m","7m 9m 10M 13m"],"7b13":["3M 6m 7m 9m","7m 9m 10M 13m"],o7:["1P 3m 5d 6M","5d 6M 8P 10m"],"7#11":["7m 9M 11A 13A"],"7#9":["3M 7m 9A"],mM7:["3m 5P 7M 9M","7M 9M 10m 12P"],m6:["3m 5P 6M 9M","6M 9M 10m 12P"]},an=rn;function fa(e,t=an){if(t[e])return t[e];let{aliases:n}=se.get("C"+e),r=Object.keys(t).find(a=>n.includes(a))||"";if(r!==void 0)return t[r]}var on={lookup:fa,lefthand:rn,triads:la,all:da,defaultDictionary:an};var uo=on.all,lo=nn.topNoteDiff;function ga(e,t,n){return function(...r){return console.warn(`${e} is deprecated. Use ${t}.`),n.apply(this,r)}}var ho=ga("isNamed","isNamedPitch",E);function b(e){return Array(e).fill(void 0)}var mn=[{name:"C",friendlyName:"C",distanceFromC:"1P"},{name:"C#",friendlyName:"C#/Db",distanceFromC:"2m"},{name:"D",friendlyName:"D",distanceFromC:"2M"},{name:"D#",friendlyName:"D#/Eb",distanceFromC:"3m"},{name:"E",friendlyName:"E",distanceFromC:"3M"},{name:"F",friendlyName:"F",distanceFromC:"4P"},{name:"F#",friendlyName:"F#/Gb",distanceFromC:"5d"},{name:"G",friendlyName:"G",distanceFromC:"-4P"},{name:"G#",friendlyName:"G#/Ab",distanceFromC:"-3M"},{name:"A",friendlyName:"A",distanceFromC:"-3m"},{name:"A#",friendlyName:"A#/Bb",distanceFromC:"-2M"},{name:"B",friendlyName:"B",distanceFromC:"-2m"}];var Be=[{name:"acoustic_grand_piano",friendlyName:"Acoustic Grand Piano",midi:0,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"bright_acoustic_piano",friendlyName:"Bright Acoustic Piano",midi:1,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"electric_grand_piano",friendlyName:"Electric Grand Piano",midi:2,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"honkytonk_piano",friendlyName:"Honkytonk Piano",midi:3,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"electric_piano_1",friendlyName:"Electric Piano 1",midi:4,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"electric_piano_2",friendlyName:"Electric Piano 2",midi:5,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"harpsichord",friendlyName:"Harpsichord",midi:6,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"clavinet",friendlyName:"Clavinet",midi:7,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"celesta",friendlyName:"Celesta",midi:8,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"glockenspiel",friendlyName:"Glockenspiel",midi:9,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"music_box",friendlyName:"Music Box",midi:10,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"vibraphone",friendlyName:"Vibraphone",midi:11,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"marimba",friendlyName:"Marimba",midi:12,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"xylophone",friendlyName:"Xylophone",midi:13,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"tubular_bells",friendlyName:"Tubular Bells",midi:14,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"dulcimer",friendlyName:"Dulcimer",midi:15,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"drawbar_organ",friendlyName:"Drawbar Organ",midi:16,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"percussive_organ",friendlyName:"Percussive Organ",midi:17,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"rock_organ",friendlyName:"Rock Organ",midi:18,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"church_organ",friendlyName:"Church Organ",midi:19,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"reed_organ",friendlyName:"Reed Organ",midi:20,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"accordion",friendlyName:"Accordion",midi:21,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"harmonica",friendlyName:"Harmonica",midi:22,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"tango_accordion",friendlyName:"Tango Accordion",midi:23,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"acoustic_guitar_nylon",friendlyName:"Acoustic Guitar Nylon",midi:24,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"acoustic_guitar_steel",friendlyName:"Acoustic Guitar Steel",midi:25,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"electric_guitar_jazz",friendlyName:"Electric Guitar Jazz",midi:26,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"electric_guitar_clean",friendlyName:"Electric Guitar Clean",midi:27,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"electric_guitar_muted",friendlyName:"Electric Guitar Muted",midi:28,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"overdriven_guitar",friendlyName:"Overdriven Guitar",midi:29,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"distortion_guitar",friendlyName:"Distortion Guitar",midi:30,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"guitar_harmonics",friendlyName:"Guitar Harmonics",midi:31,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"acoustic_bass",friendlyName:"Acoustic Bass",midi:32,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"electric_bass_finger",friendlyName:"Electric Bass Finger",midi:33,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"electric_bass_pick",friendlyName:"Electric Bass Pick",midi:34,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"fretless_bass",friendlyName:"Fretless Bass",midi:35,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"slap_bass_1",friendlyName:"Slap Bass 1",midi:36,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"slap_bass_2",friendlyName:"Slap Bass 2",midi:37,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"synth_bass_1",friendlyName:"Synth Bass 1",midi:38,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"synth_bass_2",friendlyName:"Synth Bass 2",midi:39,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"violin",friendlyName:"Violin",midi:40,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"viola",friendlyName:"Viola",midi:41,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"cello",friendlyName:"Cello",midi:42,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"contrabass",friendlyName:"Contrabass",midi:43,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"tremolo_strings",friendlyName:"Tremolo Strings",midi:44,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"pizzicato_strings",friendlyName:"Pizzicato Strings",midi:45,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"orchestral_harp",friendlyName:"Orchestral Harp",midi:46,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"timpani",friendlyName:"Timpani",midi:47,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"string_ensemble_1",friendlyName:"String Ensemble 1",midi:48,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"string_ensemble_2",friendlyName:"String Ensemble 2",midi:49,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"synth_strings_1",friendlyName:"Synth Strings 1",midi:50,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"synth_strings_2",friendlyName:"Synth Strings 2",midi:51,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"choir_aahs",friendlyName:"Choir Aahs",midi:52,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"voice_oohs",friendlyName:"Voice Oohs",midi:53,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"synth_choir",friendlyName:"Synth Choir",midi:54,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"orchestra_hit",friendlyName:"Orchestra Hit",midi:55,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"trumpet",friendlyName:"Trumpet",midi:56,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"trombone",friendlyName:"Trombone",midi:57,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"tuba",friendlyName:"Tuba",midi:58,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"muted_trumpet",friendlyName:"Muted Trumpet",midi:59,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"french_horn",friendlyName:"French Horn",midi:60,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"brass_section",friendlyName:"Brass Section",midi:61,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"synth_brass_1",friendlyName:"Synth Brass 1",midi:62,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"synth_brass_2",friendlyName:"Synth Brass 2",midi:63,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"soprano_sax",friendlyName:"Soprano Sax",midi:64,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"alto_sax",friendlyName:"Alto Sax",midi:65,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"tenor_sax",friendlyName:"Tenor Sax",midi:66,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"baritone_sax",friendlyName:"Baritone Sax",midi:67,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"oboe",friendlyName:"Oboe",midi:68,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"english_horn",friendlyName:"English Horn",midi:69,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"bassoon",friendlyName:"Bassoon",midi:70,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"clarinet",friendlyName:"Clarinet",midi:71,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"piccolo",friendlyName:"Piccolo",midi:72,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"flute",friendlyName:"Flute",midi:73,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"recorder",friendlyName:"Recorder",midi:74,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"pan_flute",friendlyName:"Pan Flute",midi:75,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"blown_bottle",friendlyName:"Blown Bottle",midi:76,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"shakuhachi",friendlyName:"Shakuhachi",midi:77,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"whistle",friendlyName:"Whistle",midi:78,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"ocarina",friendlyName:"Ocarina",midi:79,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"lead_1_square",friendlyName:"Lead 1 Square",midi:80,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"lead_2_sawtooth",friendlyName:"Lead 2 Sawtooth",midi:81,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"lead_3_calliope",friendlyName:"Lead 3 Calliope",midi:82,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"lead_4_chiff",friendlyName:"Lead 4 Chiff",midi:83,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"lead_5_charang",friendlyName:"Lead 5 Charang",midi:84,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"lead_6_voice",friendlyName:"Lead 6 Voice",midi:85,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"lead_7_fifths",friendlyName:"Lead 7 Fifths",midi:86,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"lead_8_bass__lead",friendlyName:"Lead 8 Bass Lead",midi:87,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"pad_1_new_age",friendlyName:"Pad 1 New Age",midi:88,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"pad_2_warm",friendlyName:"Pad 2 Warm",midi:89,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"pad_3_polysynth",friendlyName:"Pad 3 Polysynth",midi:90,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"pad_4_choir",friendlyName:"Pad 4 Choir",midi:91,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"pad_5_bowed",friendlyName:"Pad 5 Bowed",midi:92,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"pad_6_metallic",friendlyName:"Pad 6 Metallic",midi:93,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"pad_7_halo",friendlyName:"Pad 7 Halo",midi:94,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"pad_8_sweep",friendlyName:"Pad 8 Sweep",midi:95,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"fx_1_rain",friendlyName:"Fx 1 Rain",midi:96,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"fx_2_soundtrack",friendlyName:"Fx 2 Soundtrack",midi:97,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"fx_3_crystal",friendlyName:"Fx 3 Crystal",midi:98,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"fx_4_atmosphere",friendlyName:"Fx 4 Atmosphere",midi:99,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"fx_5_brightness",friendlyName:"Fx 5 Brightness",midi:100,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"fx_6_goblins",friendlyName:"Fx 6 Goblins",midi:101,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"fx_7_echoes",friendlyName:"Fx 7 Echoes",midi:102,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"fx_8_scifi",friendlyName:"Fx 8 Scifi",midi:103,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"sitar",friendlyName:"Sitar",midi:104,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"banjo",friendlyName:"Banjo",midi:105,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"shamisen",friendlyName:"Shamisen",midi:106,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"koto",friendlyName:"Koto",midi:107,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"kalimba",friendlyName:"Kalimba",midi:108,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"bagpipe",friendlyName:"Bagpipe",midi:109,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"fiddle",friendlyName:"Fiddle",midi:110,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"shanai",friendlyName:"Shanai",midi:111,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"tinkle_bell",friendlyName:"Tinkle Bell",midi:112,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"agogo",friendlyName:"Agogo",midi:113,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"steel_drums",friendlyName:"Steel Drums",midi:114,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"woodblock",friendlyName:"Woodblock",midi:115,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"taiko_drum",friendlyName:"Taiko Drum",midi:116,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"melodic_tom",friendlyName:"Melodic Tom",midi:117,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"synth_drum",friendlyName:"Synth Drum",midi:118,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"reverse_cymbal",friendlyName:"Reverse Cymbal",midi:119,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"guitar_fret_noise",friendlyName:"Guitar Fret Noise",midi:120,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"breath_noise",friendlyName:"Breath Noise",midi:121,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"seashore",friendlyName:"Seashore",midi:122,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"bird_tweet",friendlyName:"Bird Tweet",midi:123,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"telephone_ring",friendlyName:"Telephone Ring",midi:124,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"helicopter",friendlyName:"Helicopter",midi:125,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"applause",friendlyName:"Applause",midi:126,fg:!0,bg:!0,min:"A0",max:"C8"},{name:"gunshot",friendlyName:"Gunshot",midi:127,fg:!0,bg:!0,min:"A0",max:"C8"}];function Ma(e){let t=Be.filter(n=>e.fgInstruments.names.includes(n.name));return b(e.fgInstruments.poolSize).map(()=>p.choice(t))}function ya(e){let t=Be.filter(n=>e.bgInstruments.names.includes(n.name));return b(e.bgInstruments.poolSize).map(()=>p.choice(t))}function sn(e,t){let n=b(e).map((i,o)=>o).concat(b(t-e).map(()=>p.int(0,e-1))).reduce((i,o)=>(i[o]+=1,i),Array(e).fill(0)),r=[],a=0;for(let i=0;i<n.length;i++){let o=n[i];r.push({startAt:a,length:o}),a+=o}return r}function ba(e,t,n){let r=t.filter(a=>[e.melody.noteOctaveMin,e.melody.noteOctaveMax].includes(a.oct));return p.float()>e.melody.pauseProbability?{note:p.choice(r),cell:n}:void 0}function va(e,t,n){return p.float()>e.chords.pauseProbability?{chord:p.choice(t),cell:n}:void 0}function Aa(e,t,n){let r=p.int(e.melody.symbolsPerMeasureMin,e.melody.symbolsPerMeasureMax),a=sn(r,e.melody.dotsPerMeasure),i=p.int(e.chords.symbolsPerMeasureMin,e.chords.symbolsPerMeasureMax),o=sn(i,e.chords.dotsPerMeasure);return{notes:a.map(m=>ba(e,t,m)).filter(m=>m!==void 0),chords:o.map(m=>va(e,n,m)).filter(m=>m!==void 0)}}function Na(e,t,n){let r;do{let s=p.choice(e.phrase.scaleNames);r=Pe.get(`C ${s}`)}while(!r.notes.length);let a=r.notes.map(P.chroma),i=t.filter(s=>a.includes(s.chroma)),o=n.filter(s=>s.notes.map(P.chroma).every(c=>a.includes(c))),m=p.int(e.phrase.measuresPerPhraseMin,e.phrase.measuresPerPhraseMax);return{bpm:p.int(e.phrase.bpmMin,e.phrase.bpmMax),measures:b(m).map(()=>Aa(e,i,o))}}function xa(e,t,n){return b(e.phrase.poolSize).map(()=>Na(e,t,n))}function Ca(e,t){switch(t){case"SEQ_ASC":return P.sortedNames(e,P.ascending);case"SEQ_DESC":return P.sortedNames(e,P.descending);case"ARP_ASC":let n=P.sortedNames(e,P.ascending);return n.concat(n.slice(1,-1).reverse());case"ARP_DESC":let r=P.sortedNames(e,P.descending);return r.concat(r.slice(1,-1).reverse());case"RND":return e.map(a=>({n:a,sort:p.float()})).sort((a,i)=>a.sort-i.sort).map(a=>a.n)}}function _a(e,t,n,r){let a=e.melody.dotsPerMeasure/e.chords.dotsPerMeasure,i=t.cell.startAt*a,o=t.cell.length*a,m=t.chord.notes.map(s=>s+p.int(e.chords.noteOctaveMin,e.chords.noteOctaveMax));if(n==="FULL")return m.map(P.get).map(s=>({note:s,cell:{startAt:i,length:o}}));{let s=Ca(m,n);return b(o/r).map((f,l)=>s[l%s.length]).map((f,l)=>({note:P.get(f),cell:{startAt:i+l*r,length:r}}))}}function Sa(e,t){let n=p.choice(e.phrase.tonics),r=mn.find(a=>a.name===n).distanceFromC;return{bpm:t.bpm,measures:t.measures.map(a=>({notes:a.notes.map(i=>({note:P.get(P.transpose(i.note.name,r)),cell:i.cell})),chords:a.chords.map(i=>({chord:Y.get(Y.transpose(i.chord.name,r)),cell:i.cell}))}))}}function Ia(e,t,n,r){let a=p.int(e.structure.rootChildsMin,e.structure.rootChildsMax),i=p.int(e.structure.treeDepthMin,e.structure.treeDepthMax),o=c=>{let f=p.int(e.structure.childsPerNodeMin,e.structure.childsPerNodeMax);return{loop:p.int(e.structure.nodeLoopMin,e.structure.nodeLoopMax),childs:b(f).map(()=>s(c))}},m=()=>{let c=p.choice(r),f=Sa(e,c),l=p.int(e.fgInstruments.instrumentsPerPhraseMin,e.fgInstruments.instrumentsPerPhraseMax),h=b(l).map(()=>p.choice(t)).map(k=>({instrument:k,measures:f.measures})),M=p.int(e.bgInstruments.instrumentsPerPhraseMin,e.bgInstruments.instrumentsPerPhraseMax),v=b(M).map(()=>p.choice(n)).map(k=>{let I=p.choice(e.chords.arpeggioTypes),Me=p.choice(e.chords.arpeggioNoteLengths),ye=f.measures.map(be=>({notes:be.chords.flatMap(un=>_a(e,un,I,Me))}));return{instrument:k,measures:ye}});return{phrase:f,tracks:h.concat(v)}},s=c=>c<i&&p.float()<e.structure.nodeChildProbability?o(c+1):m();return b(a).map(()=>s(1))}function Ta(e,t){let n=[],r=0,a=i=>i.forEach(o=>{if(o.childs)b(o.loop).forEach(()=>a(o.childs));else{let m={channel:0,bpm:o.phrase.bpm,startAt:r};n.push(m),o.tracks.forEach((s,c)=>{let f={channel:c,instrument:s.instrument,startAt:r};n.push(f);let l=r;s.measures.forEach(h=>{h.notes.forEach(M=>{let v={channel:c,note:M.note.midi,startAt:l+M.cell.startAt,length:M.cell.length};n.push(v)}),l+=e.melody.dotsPerMeasure})}),r+=o.phrase.measures.length*e.melody.dotsPerMeasure}});return a(t),n}function cn(e,t,n){let r=Ma(e),a=ya(e),i=xa(e,t,n),o=Ia(e,r,a,i);return Ta(e,o)}addEventListener("message",e=>{let t=cn(...e.data);postMessage(t)});
